<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>     
	<META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
	<LINK href="resources/styles.css" type=text/css rel=stylesheet>
	<p class=Title> 
	<font face="Tahoma" size="3">
	    <center> 
	        <b>Programming EZ-USB&reg; FX3&trade; Processor Port as Synchronous Slave FIFO</b>
	    </center></p> 
	</font>
   </head>
 
  <body>
   <font face="Tahoma" size="2">      
      <p class=Title>Introduction</p>
      <p class=BodyText>
		One of the key features of EZ-USB&reg; FX3&trade; is the flexibility and programmability of the General Programmable Interface (GPIF&trade;II). GPIF&trade;II is a programmable state machine that enables a flexible interface to adapt to any processor interface required by the user. GPIF&trade;II state machine is defined by a set of programmable registers. These registers are to be configured by the firmware application running on FX3. The register configuration that programs GPIF&trade;II for a specific interface can be generated by the software tool GPIF&trade;II Designer.	This document provides details on how to generate and use Synchronous Slave FIFO Interface on GPIF&trade;II using the tool.
		</p>

<p class=Title>Synchronous Slave FIFO Interface</p>
    <p><b>Feature Highlights </b></p>
        <p class=BodyText>
          <ul>
		<li class=BodyText>Controlled data path to USB and other FX3 Peripheral interfaces</li>
		<li class=BodyText>Configurable DMA Flags indicates data flow congestion</li>
		<li class=BodyText>Thread / socket selection using Address lines</li>
		<li class=BodyText>Support for Short packet and Zero length packet for USB</li>		
	  </ul>
</p>

	<p style="text-align: center; line-height: 1.15; margin: 0px 0px 13px 0px;">
		<img src="resources/sync_fifo_pin_diagram.jpg" width="500" 
		vspace="1" hspace="1" border="0" alt=""></p>
	<p style="text-align: center; line-height: 1.15; margin: 0px 0px 13px 0px;">
		<span style="font-family: 'Calibri'; font-weight: bold;">
		Figure 1. Synchronous Slave FIFO Interface Diagram </span></p>

<p class=BodyText>
	Synchronous Slave FIFO interface is ideal for applications where an external processor or device needs to perform data read/write accesses to FX3's internal FIFO buffers. <b>Figure 1 </b>shows the interface diagram for the Synchronous Slave FIFO interface. The Synchronous Slave FIFO interface provides the external processor (which acts as Master initiating the transfer) a data path to the USB port. The data path can be created to any of the FX3 peripherals as well. The external processor can view the FX3 port as FIFO that can be accessed through single cycle or burst.
	<br/>
	<br/>
	EZ-USB&reg; FX3&trade; provides up to four physical threads for data transfer over GPIF II. At a time, any one socket may be mapped to a thread. The sockets that are to be used must be mapped to a thread in the firmware. The addressing mode can be a pre selected thread or a dynamically selected thread through the two bits of the address bus. The external processor can control the data path access depending on the traffic using the DMA flags provided by FX3. A flag indicate the status of a particular socket connected to a thread. The two flags namely FLAGA & FLAGB indicate empty/full/partial conditions of the associated socket of the thread. 	
</p>

      <p class=Title>Programming GPIF&trade;II as Synchronous Slave FIFO</p>

    <p class=BodyText>
	The set of register values that programs the GPIF&trade;II interface as Synchronous Slave FIFO can be generated using GPIF&trade;II Designer. GPIF&trade;II Designer generates a "C" header file containing data structures supported the FX3 firmware framework API. The software tool GPIF&trade;II Designer and the firmware framework library are part of the EZ-USB&reg; FX3&trade; Software Development Kit. A step by step procedure to use GPIF&trade;II Designer to configure FX3 as Synchronous FIFO is as follows
    </p>
      <p class=BodyText>
       <ol>
        <li class=BodyText>
		Open the sync_slave_fifo using GPIF&trade;II Designer. The project can be opened from the "Cypress Supplied Interface" menu on the start page.
	    </li>
        <li class=BodyText>
		The project details are presented in three tabs - Interface Customization, State Machine and Datasheet. Traverse to Interface Customization tab to make necessary customizations. Customizable parameters are shown on the left pane.
	    </li>            
	    <li class=BodyText>
		Build the project to generate GPIF&trade;II configuration header file using the "Build Project" command available under the Build menu. 
		The header file with cyfxgpif2config.h will be generated under the project folder.
	    </li>
        <li class=BodyText>
		In the firmware application load the GPIF&trade;II configuration and start the state machine using the GPIF&trade;II configuration API <Link TBD> 
	    </li>
          </ol>
        </p>

      <p class=Title>Configurable Parameters</p>

    <p class=BodyText>
        Following parameters of the interface can be modified to suite the target environment. 
        To make changes, open the sync_slave_fifo using GPIF&trade;II Designer as mentioned in step 1. 
        The configurable parameters and available options are provided on the left side of the Customization Tab.
        <br/>
		<br/>	
		<b>FX3 peripherals used:</b> SPI, UART,I2C,I2S can be selected. 
		<br/>
		<br/>		
        <b>Data bus width:</b> Data bus width of GPIF II can be 8 Bit, 16 Bit or 32 Bit. 32 Bit data bus width is not supported if SPI is selected.
		<br/>
		<br/>
		<b>Endianess:</b> Endianness can be BigEndian or LittleEndian.				
        <br/>
		<br/>
		<b>FLAGA / FLAGB connected:</b> Flags indicate the status of the socket connected to thread. Flags can be selected from a dedicated thread or current thread selected.
		By default CY_U3P_PIB_SOCKET_0 is connected to Thread 0, CY_U3P_PIB_SOCKET_1 is connected to Thread 1, CY_U3P_PIB_SOCKET_2 is connected to Thread 2 and CY_U3P_PIB_SOCKET_3 is connected to Thread 3. The socket number can be changed using the in the firmware using API CyU3PGpifSocketConfigure.
		<br/>
		<br/>
        <b>Pin mapping:</b> Mapping of the interface signals (SLCS#, SLWR#, SLRD# and PKEND#) to the FX3 pin connections can be modified. To modify the pin mapping click on the control pins on the EZ-USB&reg; FX3&trade; block on the Pin diagram appearing on the customization tab. The drop down menu shows available pins that can be mapped.
        <br>
        <i> Note: To swap pins currently allocated pin must be freed. A pin can be freed by allocating to any other available pin temporarily.
		</i>
    </p>

<p class=Title>Interface Description & Timing</p>

<p class=BodyText>
The Synchronous Slave FIFO provides three different type of accesses.
    <ul>
        <li class=BodyText>Read - Reading from the specified address </li>
        <li class=BodyText>Write - Writing to the associated buffer</li>         
        <li class=BodyText>Zero length packet - Committing a zero length packet.</li>
    </ul>
</p>

<p class=BodyText>
<b>Read</b>
<br>
 The Read accesses can be single cycle access or burst access. Figure 2 shows the timing and sequence for Asynchronous Slave FIFO read accesses. 
 Note that register accesses cannot be performed over the Slave FIFO interface. 
<ul>
	<li class=BodyText> 
	FIFO address is stable and the SLCS# signal is asserted.
	</li>
	<li class=BodyText>  
	SLOE# is asserted. SLOE# is an output enable only, whose sole function is to drive the data bus
	</li>
	<li class=BodyText> 
	SLRD# is asserted. 
	</li>
	<li class=BodyText>
	The FIFO pointer is updated on the rising edge of the PCLK, while the SLRD is asserted. This starts the propagation of data from the newly addressed location to the data bus. After a propagation delay of tco (measured from the rising edge of PCLK) the new data value is present. </li>
</ul>
</p>

<p style="text-align: center; line-height: 1.15; margin: 0px 0px 13px 0px;">
	<img src="resources/sync_fifo_read_timing.jpg" width="650" 
	vspace="1" hspace="1" border="0" alt="">
</p>
	<p style="text-align: center; line-height: 1.15; margin: 0px 0px 13px 0px;">
	<span style="font-family: 'Calibri'; font-weight: bold;">
	Figure 2 Timing Diagram - Synchronous Slave FIFO READ </span>
</p>
<p class=BodyText>
	In the above diagram, data N is the first valid data read from the FIFO. To have data on the FIFO data bus, SLOE# must also be asserted. For burst mode, the SLRD# and SLOE# are left asserted during the entire duration of the read. When SLOE# is asserted, the data bus is driven (with data from the previously addressed FIFO). For each subsequent rising edge of PCLK, while the SLRD# is asserted, the FIFO pointer is incremented and the next data value is placed on the data bus.
</p>

<p class=BodyText>
<b>Write</b>
<br>
	The Write accesses can be single cycle access or burst access. Figure 3 shows the timing and sequence for Synchronous Slave FIFO write accesses. Note that register accesses cannot be performed over the Slave FIFO interface. 
<ul>
	<li class=BodyText> FIFO address is driven and SLCS# is asserted</li>
	<li class=BodyText> External master/peripheral outputs the data onto the data bus</li>
	<li class=BodyText> SLWR# is asserted </li>
	<li class=BodyText> While the SLWR# is asserted, data is written to the FIFO and on the rising edge of the PCLK, the FIFO pointer is incremented</li>
	<li class=BodyText> The FIFO is updated after a delay of tWFLG from the rising edge of the clock</li>
</ul>
</p>

<p style="text-align: center; line-height: 1.15; margin: 0px 0px 13px 0px;">
	<img src="resources/sync_fifo_write_timing.jpg" width="650" 
	vspace="1" hspace="1" border="0" alt="">
</p>
<p style="text-align: center; line-height: 1.15; margin: 0px 0px 13px 0px;">
	<span style="font-family: 'Calibri'; font-weight: 
	bold;"> Figure 3 Timing Diagram - Synchronous Slave FIFO WRITE </span></p>

<p class=BodyText>
	The same sequence of events as shown in a burst read is shown for a burst write. In burst write mode, SLWR# de-assertion, the data is written to the FIFO and then the FIFO pointer is incremented. A short packet can be committed to the USB host by using PKTEND#. Application processor connected should assert PKTEND# along with last word of data and SLWR# pulse corresponding to the last word. The FIFO ADDR lines should be constant during the PKTEND# assertion.
</p>




<p class=BodyText>
<b>Zero Length Packet</b>
<br/>
 A zero length packet can be committed to the USB host by using PKTEND#. Application processor connected should assert PKTEND#
</p>


<p style="text-align: center; line-height: 1.15; margin: 0px 0px 13px 0px;">
	<img src="resources/sync_fifo_zlp_timing.jpg" width="350"  
	vspace="1" hspace="1" border="0" alt="">
</p>
<p style="text-align: center; line-height: 1.15; margin: 0px 0px 13px 0px;">
	<span style="font-family: 'Calibri'; font-weight: bold;">
	Figure 4 Timing Diagram - Synchronous Slave FIFO Zero Length Packet</span>
</p>


<p class=Title>Summary</p>
<p class=BodyText>
The data presented here is indicative only and must not be seen as a substitute for the full specification 
from which it is drawn. Please visit 
<a href="http://www.cypress.com/?id=3526">Cypress EZ-USB&reg; FX3&trade;</a> website for detailed and 
latest Datasheet.

</p>

<p class=Title>Notice of Disclaimer</p>
<p class=BodyText>

© Cypress Semiconductor Corporation, 2012. The information contained herein is subject to 
change without notice. Cypress Semiconductor Corporation assumes no responsibility 
for the use of any circuitry other than circuitry embodied in a Cypress Semiconductor product. 
Nor does it convey or imply any license under patent or other rights. 
Cypress Semiconductor does not authorize its products for use as critical components in 
life-support systems where a malfunction or failure may reasonably be expected to result 
in significant injury to the user. The inclusion of Cypress Semiconductor products in 
life-support systems application implies that the manufacturer assumes all risk of such 
use and in doing so indemnifies Cypress Semiconductor against all charges.
</p>
  </font>
  </body>
</html>
